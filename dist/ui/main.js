(()=>{function e(e,t,a,n){Object.defineProperty(e,t,{get:a,set:n,enumerable:!0,configurable:!0})}function t(e){if(e=i.i?.[e]||e,!a)try{throw Error()}catch(n){var t=(""+n.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(!t)return s+e;a=t[0]}return new URL(s+e,a).toString()}var a,n=globalThis,s="./",o={},r={},i=n.parcelRequire44b2;null==i&&((i=function(e){if(e in o)return o[e].exports;if(e in r){var t=r[e];delete r[e];var a={id:e,exports:{}};return o[e]=a,t.call(a.exports,a,a.exports),a.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){r[e]=t},n.parcelRequire44b2=i);var l=i.register;l("4x2qo",function(t,a){e(t.exports,"cardPattern",()=>n),e(t.exports,"paymentCodePattern",()=>s),e(t.exports,"tokenPattern",()=>o);let n=/^[A-Za-z0-9]{4}-[A-Za-z0-9]{4}$/,s=/^[0-9]{6}$/,o=/^[0-9]{1,}\|[A-Za-z0-9]{48}$/}),l("bg6aG",function(e,a){e.exports=i("hK9Md")(t("i5ZOW")).then(()=>i("1QPxh"))}),l("hK9Md",function(e,t){"use strict";e.exports=i("3AMmx")(function(e){return new Promise(function(t,a){if([].concat(document.getElementsByTagName("script")).some(function(t){return t.src===e}))return void t();var n=document.createElement("link");n.href=e,n.rel="preload",n.as="script",document.head.appendChild(n);var s=document.createElement("script");s.async=!0,s.type="text/javascript",s.src=e,s.onerror=function(t){var n=TypeError("Failed to fetch dynamically imported module: ".concat(e,". Error: ").concat(t.message));s.onerror=s.onload=null,s.remove(),a(n)},s.onload=function(){s.onerror=s.onload=null,t()},document.getElementsByTagName("head")[0].appendChild(s)})})}),l("3AMmx",function(e,t){"use strict";var a={},n={},s={};e.exports=function(e,t){return function(o){var r=function(e){switch(e){case"preload":return n;case"prefetch":return s;default:return a}}(t);return r[o]?r[o]:r[o]=e.apply(null,arguments).catch(function(e){throw delete r[o],e})}}}),l("9amnm",function(e,a){e.exports=i("hK9Md")(t("eUbOm")).then(()=>i("fc272"))}),Object.assign(i.i??={},{i5ZOW:"alert_controller.1178a6c4.js",eUbOm:"init_form_controller.bc96f442.js"});var c=i("4x2qo"),u=class{constructor(e="",t="",a="",n=0,s="en",o={}){this.sender=this.sanitizeData(t),this.token=this.sanitizeData(e),this.otp=a,this.amount=parseFloat(n.toString()),this.language=s,this.paymentHandlers={onSuccess:o.onSuccess||(()=>{}),onFailure:o.onFailure||(()=>{})};const r=this._validate();r&&(this.validationError=r)}_validate(){let e=[];return this.sender?c.cardPattern.test(this.sender)||e.push("Sender card format is invalid."):e.push("Sender card is required."),this.token?c.tokenPattern.test(this.token)||e.push("token card format is invalid."):e.push("token is required."),this.otp?c.paymentCodePattern.test(this.otp)||e.push("Payment code format is invalid."):e.push("Payment code is required."),(isNaN(this.amount)||this.amount<=0)&&e.push("Amount must be a positive number."),["en","fr"].includes(this.language.toString().toLowerCase())||e.push("Language is invalid."),e.length>0?Error(e.join("\n")):null}async exec(){if(this.validationError)throw this.paymentHandlers.onFailure(this.validationError),this.validationError;try{let e=await fetch("https://ypay.ytech-bf.com/api/v1/project/make-payment",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`,"accept-language":this.language},body:JSON.stringify({card_code:this.sender,amount:this.amount,payment_code:this.otp})});if(e.ok){let t=await e.json();return this.paymentHandlers.onSuccess(t),t}let t=(await e.json().catch(()=>({}))).message||e.statusText||"Payment failed";throw Error(`${e.status}
${t}`)}catch(e){throw this.paymentHandlers.onFailure(e),e}}isValid(){return!this.validationError}getValidationErrors(){return this.validationError?this.validationError.message:null}sanitizeData(e=""){return""===e||null==e?"":e=(e=(e=(e=String(e)).replace(/\\0/g,"")).trim()).replace(/<[^>]*>/g,"")}};class h{static USD="USD";static NGN="NGN";static XOF="F CFA";static isValid(e){return Object.values(this).includes(e.toUpperCase())}}class d{constructor(e,t,a){this.token=e,this.currency=t||h.XOF,this.shopName=a||"Undefined";const n=this._validate();if(n&&(this.validationError=n),d.instance)return d.instance;d.instance=this}createTransaction(e,t,a,n,s={}){return new u(this.token,e,t,a,n,s).exec()}static resetInstance(){d.instance=null}_validate(){let e=[];return h.isValid(this.currency)||e.push(this.currency+" is not supported yet"),e.length>0?Error(e.join("\n")):null}}var m=class{constructor(){this.current="en",this.languages={en:"en",fr:"fr"},this.translations={en:{card_label:"Card number",card_placeholder:"Enter your card number",otp_label:"Enter OTP",message:'In order to continue the payment process, you must first log in from the <a href="#">YPAY</a> application, then generate a payment OTP with a value of ',no_app:"I do not have the app yet.",download:"Download the App",submit_button_processing:"Processing...",submit_button:"Submit",error_message:"Enter XXXX-XXXX with letters/digits only.",secured_payment:"Encrypted and Secured Payment",successful_transaction:"Your transaction was successfully processed!",failure_transaction:"Your transaction has not been processed!"},fr:{card_label:"Numéro de carte",card_placeholder:"Entrez votre numéro de carte",otp_label:"Entrez le code OTP",message:"Pour continuer le processus de paiement, vous devez d'abord vous connecter depuis l'application <a href=\"#\">YPAY</a>, puis generer un OTP de paiement d'une valeur de ",download:"Télécharger l'application",submit_button_processing:"Traitement en cours...",submit_button:"Valider",no_app:"Je n'ai pas l'application",error_message:"Format XXXX-XXXX avec lettres et chiffres uniquement.",secured_payment:"Paiement crypté et sécurisé",successful_transaction:"Votre transaction a été traitée avec succès!",failure_transaction:"Votre transaction n'a pas pu être traitée!"}}}isValid(e){return Object.values(this.languages).includes(e.toLowerCase())}setLang(e){switch(e){case this.languages.en:this.current="en";break;case this.languages.fr:this.current="fr";break;default:this.current="en"}}tag(e){return this.translations[this.current][e]||e}};class p{static instance;constructor(e,t,a,n={},s=!0,o=!0,r,i){if(p.instance)return p.instance;return this.logo=i||"",this.language=a||"en",this.shopName=r||"Unknown",this.currency=t||"XOF",this.token=e,this.modal=!1,this.verbose=o,this.showDialogs=this._normalizeShowDialogs(s),this.handlers=n||{onSuccess:e=>{},onFailure:e=>{}},this.overlayElement=null,this.newWindowRef=null,this.alert=null,this.amount=0,this.localization=new m,this.localization.setLang(this.language),this._validate(),this.ypay=new d(e,t,r),p.instance=this,this}_normalizeShowDialogs(e){return"boolean"==typeof e?{onSuccess:e,onFailure:e}:"object"==typeof e&&null!==e?{onSuccess:void 0===e.onSuccess||e.onSuccess,onFailure:void 0===e.onFailure||e.onFailure}:{onSuccess:!0,onFailure:!0}}toString(){return`PaymentUI 
        {
          shopName: "${this.shopName}",
          currency: "${this.currency}",
          language: "${this.language}",
          token: "${this.token?this.token.substring(0,8)+"...":"none"}",
          amount: ${this.amount},
          modal: ${this.modal},
          showDialogs: { onSuccess: ${this.showDialogs.onSuccess}, onFailure: ${this.showDialogs.onFailure} },
          verbose: ${this.verbose},
          hasLogo: ${!!this.logo},
          handlers: ${Object.keys(this.handlers).join(", ")}
        }`}_validate(){let e=[];if(this.language&&!this.localization.isValid(this.language)&&e.push("Language is not available"),""===this.token&&e.push("Token is required"),e.length>0)throw this.showLogs("Validation errors:",e.join("\n")),Error(e.join("\n"))}_getTargetDocument(){if(this.overlayElement)return document;if(this.newWindowRef&&!this.newWindowRef.closed)try{if(this.newWindowRef.document)return this.newWindowRef.document}catch(e){this.showLogs("Cannot access popup window document:",e.message)}return document}closePaymentUI(){this.showLogs("Closing payment UI"),this.overlayElement&&(this.overlayElement.remove(),this.overlayElement=null),this.newWindowRef&&!this.newWindowRef.closed&&(this.newWindowRef.close(),this.newWindowRef=null)}customAlertController(e,t,a){i("bg6aG").then(n=>{n.default&&"function"==typeof n.default&&n.default(e,t,a)}).catch(e=>{this.showLogs("Alert controller not available:",e)})}customAlert(e,t){("success"===e?this.showDialogs.onSuccess:this.showDialogs.onFailure)?fetch("./ypay_ui/templates/custom_alert.html").then(e=>e.text()).then(a=>{let n=document.createElement("div");n.className="alert-overlay",n.innerHTML=this.renderTemplate(a),this.alert=n,document.body.appendChild(this.alert),this.customAlertController(document,e,t);let s=this.alert.querySelector(".alert"),o=s.querySelector(".close"),r=s.getElementsByTagName("button")[0],i=()=>{this.alert&&this.alert.parentNode&&(this.alert.parentNode.removeChild(this.alert),this.alert=null);let e=this._getTargetDocument().getElementsByClassName("submit_button")[0];e&&(e.innerHTML=this.localization.tag("submit_button"),e.disabled=!1)};o.addEventListener("click",i),r.addEventListener("click",i)}).catch(e=>{this.showLogs("Failed to load alert template:",e)}):this.showLogs(`Alert (${e}):`,t)}formatAmount(){return"fr"===this.language?`${this.amount} ${this.currency}`:`${this.currency} ${this.amount}`}showModal(){this.showLogs("Opening payment modal"),fetch("./ypay_ui/templates/payment_form.html").then(e=>e.text()).then(e=>{let t=document.createElement("div");t.className="modal_overlay",t.innerHTML=this.renderTemplate(e),this.overlayElement=t,document.body.appendChild(t),setTimeout(()=>{let e=document.querySelector(".close_modal");e&&e.addEventListener("click",()=>{this.closePaymentUI()}),document.querySelector(".modal_overlay")&&document.addEventListener("keydown",e=>{"Escape"===e.key&&this.closePaymentUI()}),this.initializeFormController(document)},0)}).catch(e=>{this.showLogs("Failed to load template:",e)})}openNewTab(){this.showLogs("Opening payment in new tab"),fetch("./ypay_ui/templates/payment_form.html").then(e=>e.text()).then(e=>{let t=window.open("","_blank");if(!t){let e="Popup blocked - please allow popups for this site";throw this.showLogs(e),Error(e)}this.newWindowRef=t,t.document.write(this.renderTemplate(e)),t.document.close(),t.addEventListener("load",()=>{this.initializeFormController(t.document)}),t.focus()}).catch(e=>{this.showLogs("Failed to open payment tab:",e)})}getTemplateData(){return{language:this.language,logoImg:this.logo?`<img src="${this.logo}" alt="Shop Logo"/>`:"",shopName:this.shopName,amount:this.formatAmount(),texts:{message:this.localization.tag("message"),no_app:this.localization.tag("no_app"),download:this.localization.tag("download"),card_label:this.localization.tag("card_label"),card_placeholder:this.localization.tag("card_placeholder"),card_error:this.localization.tag("error_message"),otp_label:this.localization.tag("otp_label"),submit_button:this.localization.tag("submit_button"),secured_payment:this.localization.tag("secured_payment")}}}renderTemplate(e){let t=this.getTemplateData();return e.replace(/\{\{language\}\}/g,t.language).replace(/\{\{logoImg\}\}/g,t.logoImg).replace(/\{\{closeBtn\}\}/g,this.modal?'<button class="close_modal" type="button">×</button>':"").replace(/\{\{shopName\}\}/g,t.shopName).replace(/\{\{amount\}\}/g,t.amount).replace(/\{\{texts\.message\}\}/g,t.texts.message).replace(/\{\{texts\.no_app\}\}/g,t.texts.no_app).replace(/\{\{texts\.download\}\}/g,t.texts.download).replace(/\{\{texts\.card_label\}\}/g,t.texts.card_label).replace(/\{\{texts\.card_placeholder\}\}/g,t.texts.card_placeholder).replace(/\{\{texts\.card_error\}\}/g,t.texts.card_error).replace(/\{\{texts\.otp_label\}\}/g,t.texts.otp_label).replace(/\{\{texts\.submit_button\}\}/g,t.texts.submit_button).replace(/\{\{texts\.secured_payment\}\}/g,t.texts.secured_payment)}initializeFormController(e){this.showLogs("Initializing form controller"),i("9amnm").then(t=>{t.default&&"function"==typeof t.default&&t.default(e)}).catch(e=>{this.showLogs("Form controller not available:",e)});let t=e.getElementById("payment_form");t&&t.addEventListener("submit",e=>{e.preventDefault(),this.triggerPayment()})}async triggerPayment(){this.showLogs("Payment triggered",{amount:this.amount,currency:this.currency});let e=this.newWindowRef?this.newWindowRef.document:document,t=e.querySelector(".submit_button");try{let a=e.getElementById("card_code").value.trim(),n=e.getElementsByClassName("otp_input_item"),s=parseInt([...n].map(e=>e.value).join(""));this.showLogs("Processing payment with card:",a.substring(0,4)+"****"),t&&(t.innerHTML=this.localization.tag("submit_button_processing"));let o=await this.ypay.createTransaction(a,s,this.amount,this.localization.current);this.showLogs("Payment successful:",o),this.customAlert("success",o),this.closePaymentUI(),this.handlers.onSuccess&&this.handlers.onSuccess(o)}catch(e){this.showLogs("Payment error:",e),this.customAlert("failure",e),t&&(t.innerHTML=this.localization.tag("submit_button"),t.style.disabled=!1),this.handlers.onFailure&&this.handlers.onFailure(e)}}renderForm(){this.showLogs("Rendering payment form",{modal:this.modal,amount:this.amount,currency:this.currency}),this.modal?this.showModal():this.openNewTab()}showLogs(...e){this.verbose&&console.log("[PaymentUI]",...e)}}document.querySelectorAll(".payment_btn, .custom_payment_btn").forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.amount||0,a=e.dataset.modal||!1,n=p.instance;n.amount=parseFloat(t),n.modal=a,n.renderForm()})})})();
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).YPAY=t()}(this,function(){"use strict";var e=Object.defineProperty,t=(t,n,s)=>((t,n,s)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s)(t,"symbol"!=typeof n?n+"":n,s);const n=/^[A-Za-z0-9]{4}-[A-Za-z0-9]{4}$/,s=/^[0-9]{6}$/,o=/^[0-9]{1,}\|[A-Za-z0-9]{48}$/;class a{constructor(e="",t="",n="",s=0,o="en",a={}){this.sender=this.sanitizeData(t),this.token=this.sanitizeData(e),this.otp=n,this.amount=parseFloat(s.toString()),this.language=o,this.paymentHandlers={onSuccess:a.onSuccess||(()=>{}),onFailure:a.onFailure||(()=>{})};const i=this._validate();i&&(this.validationError=i)}_validate(){const e=[];return this.sender?n.test(this.sender)||e.push("Sender card format is invalid."):e.push("Sender card is required."),this.token?o.test(this.token)||e.push("token card format is invalid."):e.push("token is required."),this.otp?s.test(this.otp)||e.push("Payment code format is invalid."):e.push("Payment code is required."),(isNaN(this.amount)||this.amount<=0)&&e.push("Amount must be a positive number."),["en","fr"].includes(this.language.toString().toLowerCase())||e.push("Language is invalid."),e.length>0?new Error(e.join("\n")):null}async exec(){if(this.validationError)throw this.paymentHandlers.onFailure(this.validationError),this.validationError;try{const e=await fetch("https://ypay.ytech-bf.com/api/v1/project/make-payment",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`,"accept-language":this.language},body:JSON.stringify({card_code:this.sender,amount:this.amount,payment_code:this.otp})});if(e.ok){const t=await e.json();return this.paymentHandlers.onSuccess(t),t}const t=(await e.json().catch(()=>({}))).message||e.statusText||"Payment failed";throw new Error(`${e.status}\n${t}`)}catch(e){throw this.paymentHandlers.onFailure(e),e}}isValid(){return!this.validationError}getValidationErrors(){return this.validationError?this.validationError.message:null}sanitizeData(e=""){return""===e||null==e?"":e=(e=(e=(e=String(e)).replace(/\\0/g,"")).trim()).replace(/<[^>]*>/g,"")}}class i{static isValid(e){return Object.values(this).includes(e.toUpperCase())}}t(i,"USD","USD"),t(i,"NGN","NGN"),t(i,"XOF","F CFA");class r{constructor(e,t,n){this.token=e,this.currency=t||i.XOF,this.shopName=n||"Undefined";const s=this._validate();if(s&&(this.validationError=s),r.instance)return r.instance;r.instance=this}createTransaction(e,t,n,s,o={}){return new a(this.token,e,t,n,s,o).exec()}static resetInstance(){r.instance=null}_validate(){const e=[];return i.isValid(this.currency)||e.push(this.currency+" is not supported yet"),e.length>0?new Error(e.join("\n")):null}}class l{constructor(){this.current="en",this.languages={en:"en",fr:"fr"},this.translations={en:{card_label:"Card number",card_placeholder:"Enter your card number",otp_label:"Enter OTP",message:'In order to continue the payment process, you must first log in from the <a href="#">YPAY</a> application, then generate a payment OTP with a value of ',no_app:"I do not have the app yet.",download:"Download the App",submit_button_processing:"Processing...",submit_button:"Submit",error_message:"Enter XXXX-XXXX with letters/digits only.",secured_payment:"Encrypted and Secured Payment",successful_transaction:"Your transaction was successfully processed!",failure_transaction:"Your transaction has not been processed!"},fr:{card_label:"Numéro de carte",card_placeholder:"Entrez votre numéro de carte",otp_label:"Entrez le code OTP",message:"Pour continuer le processus de paiement, vous devez d'abord vous connecter depuis l'application <a href=\"#\">YPAY</a>, puis generer un OTP de paiement d'une valeur de ",download:"Télécharger l'application",submit_button_processing:"Traitement en cours...",submit_button:"Valider",no_app:"Je n'ai pas l'application",error_message:"Format XXXX-XXXX avec lettres et chiffres uniquement.",secured_payment:"Paiement crypté et sécurisé",successful_transaction:"Votre transaction a été traitée avec succès!",failure_transaction:"Votre transaction n'a pas pu être traitée!"}}}isValid(e){return Object.values(this.languages).includes(e.toLowerCase())}setLang(e){switch(e){case this.languages.en:this.current="en";break;case this.languages.fr:this.current="fr";break;default:this.current="en"}}tag(e){return this.translations[this.current][e]||e}}const c="#6047FF",u="#FF0000",d=(e=document)=>{const t=e.querySelector("form"),s=e.querySelector("#app_button"),o=e.querySelector("#card_code"),a=e.querySelector(".card_icon"),i=e.querySelector(".error_message"),r=[...e.querySelectorAll(".otp_input_item")],l=e.querySelector(".submit_button");if(i.style.display="none",!t||!o||!l||0===r.length)return void console.error("Form elements not found");const d=e=>{e?(l.disabled=!1,l.style.backgroundColor=c,l.style.cursor="pointer"):(l.disabled=!0,l.style.backgroundColor="#E5E7EB",l.style.cursor="not-allowed")},h=()=>{const e=r.every(e=>1===e.value.length);r.forEach(t=>{e?(t.style.borderColor=c,t.style.outlineColor=c):""===t.value&&(t.style.borderColor="")});const t=n.test(o.value);d(t&&e)},p=e=>{if(/^[0-9]$/.test(e.key)||"Backspace"===e.key||"Delete"===e.key||"Tab"===e.key||e.metaKey||e.ctrlKey||e.preventDefault(),"Delete"===e.key||"Backspace"===e.key){const t=r.indexOf(e.target);t>=0&&(r[t].value="",t>0&&r[t-1].focus()),h(),e.preventDefault()}},m=e=>{const{target:t}=e,n=r.indexOf(t);t.value&&(n<r.length-1?r[n+1].focus():l.focus()),h()},g=e=>{e.target.select()},y=e=>{e.preventDefault();const t=e.clipboardData.getData("text");if(!new RegExp(`^[0-9]{${r.length}}$`).test(t))return;const n=t.split("");r.forEach((e,t)=>e.value=n[t]),h(),l.focus()};o.addEventListener("input",function(t){let s=o.value.toString().replace(/-/g,"");s.length>4&&(s=s.slice(0,4)+"-"+s.slice(4)),o.value=s.slice(0,9),n.test(o.value.toString())?(o.style.outlineColor=c,a&&(a.style.color=c),o.style.border=`1px solid ${c}`,i&&(i.style.display="none"),h(),a&&(a.style.top="50%")):(o.style.outlineColor=u,a&&(a.style.color=u),o.style.border=`1px solid ${u}`,e.querySelector(".error_message")||(e.createElement("span").className="error_message"),i.style.color=u,i.style.fontSize="11px",i.style.fontStyle="italic",i.style.marginTop="4px",i.style.display="block",a&&(a.style.top="35%"),o.parentNode.appendChild(i),d(!1))}),r.forEach(e=>{e.addEventListener("paste",y),e.addEventListener("input",m),e.addEventListener("keydown",p),e.addEventListener("focus",g)}),s.addEventListener("click",e=>{e.preventDefault(),window.open("https://ypay.ytech-bf.com/")}),l.disabled=!0,d(!1)},h='<!DOCTYPE html>\n<html lang="{{language}}">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Payment Gateway</title>\n    <link rel="stylesheet" href="./ypay_ui/styles/style.css">\n</head>\n<body>\n<div class="modal_box">\n    \x3c!--       HEADER     --\x3e\n    <div class="modal_header">\n        <div class="first_stack">\n            <div class="shop_icon">{{logoImg}}</div>\n            <div class="ytech_icon">\n                {{closeBtn}}\n                <img src="./ypay_ui/assets/images/logo_inverted.svg" alt="ypay logo">\n            </div>\n        </div>\n        <span class="second_stack">{{shopName}}</span>\n        <span class="third_stack">{{amount}}</span>\n    </div>\n\n    \x3c!--       YTECH MOBILE APP     --\x3e\n    <div class="modal_info">\n        <div class="message">{{texts.message}} <a>{{amount}}</a></div>\n        <div class="separator"> <hr> {{texts.no_app}} <hr></div>\n        <div class="download_button">\n            <button type="button" id="app_button">\n                {{texts.download}}\n                <svg class="download_icon" width="20px" height="20px" stroke-width="1.5" viewBox="0 0 20 20" fill="none">\n                    <path d="M6 20L18 20" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>\n                    <path d="M12 4V16M12 16L15.5 12.5M12 16L8.5 12.5" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>\n                </svg>\n            </button>\n        </div>\n    </div>\n\n    \x3c!--     FORM     --\x3e\n    <div class="modal_form">\n        <form action="#" id="payment_form">\n            <div class="form_item">\n                <label class="card_label" for="card_code">{{texts.card_label}}</label><br>\n                <div class="card_input_container">\n                    <svg class="card_icon" width="21px" height="22px" viewBox="0 0 22 22" stroke-width="1.5" fill="none">\n                        <path d="M22 9V17C22 18.1046 21.1046 19 20 19H4C2.89543 19 2 18.1046 2 17V7C2 5.89543 2.89543 5 4 5H20C21.1046 5 22 5.89543 22 7V9ZM22 9H6" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>\n                        <path d="M16.5 13.3819C16.7654 13.1444 17.1158 13 17.5 13C18.3284 13 19 13.6716 19 14.5C19 15.3284 18.3284 16 17.5 16C17.1158 16 16.7654 15.8556 16.5 15.6181" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>\n                        <path d="M16.5 13.3819C16.2346 13.1444 15.8842 13 15.5 13C14.6716 13 14 13.6716 14 14.5C14 15.3284 14.6716 16 15.5 16C15.8842 16 16.2346 15.8556 16.5 15.6181" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>\n                    </svg>\n                    <input id="card_code" class="card_code_input" type="text" autocomplete="off" placeholder="{{texts.card_placeholder}}" required>\n                    <span class="error_message">{{texts.card_error}}</span>\n                </div>\n            </div>\n\n            <div class="form_item">\n                <label for="otp_inputs" class="otp_label">{{texts.otp_label}}</label><br>\n                <div id="otp_inputs" class="otp_inputs">\n                    <label><input class="otp_input_item" type="text" maxlength="1" inputmode="numeric" autocomplete="off" required></label>\n                    <label><input class="otp_input_item" type="text" maxlength="1" inputmode="numeric"  autocomplete="off" required></label>\n                    <label><input class="otp_input_item" type="text" maxlength="1" inputmode="numeric"  autocomplete="off" required></label>\n                    <label><input class="otp_input_item" type="text" maxlength="1" inputmode="numeric"  autocomplete="off" required></label>\n                    <label><input class="otp_input_item" type="text" maxlength="1" inputmode="numeric"  autocomplete="off" required></label>\n                    <label><input class="otp_input_item" type="text" maxlength="1" inputmode="numeric"  autocomplete="off" required></label>\n                </div>\n            </div>\n\n            <div class="form_item">\n                <button class="submit_button" type="submit">{{texts.submit_button}}</button>\n            </div>\n        </form>\n\n        \x3c!--       SECURED MESSAGE     --\x3e\n        <div class="secured_payment">\n            <svg class="secured_payment_icon" width="18px" height="18px" viewBox="0 0 24 24" stroke-width="1.5" fill="none" color="#000000">\n                <path d="M22 9V7C22 5.89543 21.1046 5 20 5H4C2.89543 5 2 5.89543 2 7V17C2 18.1046 2.89543 19 4 19H14M22 9H6M22 9V13" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>\n                <path d="M21.1667 18.5H21.4C21.7314 18.5 22 18.7686 22 19.1V21.4C22 21.7314 21.7314 22 21.4 22H17.6C17.2686 22 17 21.7314 17 21.4V19.1C17 18.7686 17.2686 18.5 17.6 18.5H17.8333M21.1667 18.5V16.75C21.1667 16.1667 20.8333 15 19.5 15C18.1667 15 17.8333 16.1667 17.8333 16.75V18.5M21.1667 18.5H17.8333" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>\n            </svg>\n            <span>{{texts.secured_payment}}</span>\n        </div>\n    </div>\n</div>\n</body>\n</html>',p=class e{constructor(t,n,s,o={},a=!0,i=!0,c,u){return e.instance?e.instance:(this.logo=u||"",this.language=s||"en",this.shopName=c||"Unknown",this.currency=n||"XOF",this.token=t,this.modal=!1,this.verbose=i,this.showDialogs=this._normalizeShowDialogs(a),this.handlers=o||{onSuccess:e=>{},onFailure:e=>{}},this.overlayElement=null,this.newWindowRef=null,this.alert=null,this.amount=0,this.localization=new l,this.localization.setLang(this.language),this._validate(),this.ypay=new r(t,n,c),e.instance=this,this)}_normalizeShowDialogs(e){return"boolean"==typeof e?{onSuccess:e,onFailure:e}:"object"==typeof e&&null!==e?{onSuccess:void 0===e.onSuccess||e.onSuccess,onFailure:void 0===e.onFailure||e.onFailure}:{onSuccess:!0,onFailure:!0}}toString(){return`PaymentUI {\n          shopName: "${this.shopName}",\n          currency: "${this.currency}",\n          language: "${this.language}",\n          token: "${this.token?this.token.substring(0,8)+"...":"none"}",\n          amount: ${this.amount},\n          modal: ${this.modal},\n          showDialogs: { onSuccess: ${this.showDialogs.onSuccess}, onFailure: ${this.showDialogs.onFailure} },\n          verbose: ${this.verbose},\n          hasLogo: ${!!this.logo},\n          handlers: ${Object.keys(this.handlers).join(", ")}\n        }`}_validate(){let e=[];if(this.language&&!this.localization.isValid(this.language)&&e.push("Language is not available"),""===this.token&&e.push("Token is required"),e.length>0)throw this.showLogs("Validation errors:",e.join("\n")),new Error(e.join("\n"))}_getTargetDocument(){if(this.overlayElement)return document;if(this.newWindowRef&&!this.newWindowRef.closed)try{if(this.newWindowRef.document)return this.newWindowRef.document}catch(e){this.showLogs("Cannot access popup window document:",e.message)}return document}closePaymentUI(){this.showLogs("Closing payment UI"),this.overlayElement&&(this.overlayElement.remove(),this.overlayElement=null),this.newWindowRef&&!this.newWindowRef.closed&&(this.newWindowRef.close(),this.newWindowRef=null)}customAlertController(e,t,n){((e=document,t="success",n="")=>{const s=e.querySelector(".alert"),o=s.getElementsByTagName("h2")[0],a=s.getElementsByTagName("p")[0];o.innerHTML=t[0].toUpperCase()+t.substring(1,t.length),a.innerHTML=n,"failure"===t&&(s.classList.add("alert-failure"),s.classList.remove("alert-success"))})(e,t,n)}customAlert(e,t){if(!("success"===e?this.showDialogs.onSuccess:this.showDialogs.onFailure))return void this.showLogs(`Alert (${e}):`,t);const n=document.createElement("div");n.className="alert-overlay",n.innerHTML=this.renderTemplate('<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <title>Alert</title>\n    <link rel="stylesheet" href="./ypay_ui/styles/style.css">\n</head>\n<body>\n    <div class="alert alert-success">\n        <a href="#" class="close"  aria-label="close">×</a>\n        <div>\n            <h2>Alert</h2>\n            <p>The payment has been processed successfully</p>\n        </div>\n        <button>OK</button>\n    </div>\n</body>\n</html>'),this.alert=n,document.body.appendChild(this.alert),this.customAlertController(document,e,t);const s=this.alert.querySelector(".alert"),o=s.querySelector(".close"),a=s.getElementsByTagName("button")[0],i=()=>{this.alert&&this.alert.parentNode&&(this.alert.parentNode.removeChild(this.alert),this.alert=null);let e=this._getTargetDocument().getElementsByClassName("submit_button")[0];e&&(e.innerHTML=this.localization.tag("submit_button"),e.disabled=!1)};o.addEventListener("click",i),a.addEventListener("click",i)}formatAmount(){return"fr"===this.language?`${this.amount} ${this.currency}`:`${this.currency} ${this.amount}`}showModal(){this.showLogs("Opening payment modal");const e=document.createElement("div");e.className="modal_overlay",e.innerHTML=this.renderTemplate(h),this.overlayElement=e,document.body.appendChild(e),setTimeout(()=>{const e=document.querySelector(".close_modal");e&&e.addEventListener("click",()=>{this.closePaymentUI()});document.querySelector(".modal_overlay")&&document.addEventListener("keydown",e=>{"Escape"===e.key&&this.closePaymentUI()}),this.initializeFormController(document)},0)}openNewTab(){this.showLogs("Opening payment in new tab");const e=window.open("","_blank");if(!e){const e="Popup blocked - please allow popups for this site";throw this.showLogs(e),new Error(e)}this.newWindowRef=e,e.document.write(this.renderTemplate(h)),e.document.close(),e.addEventListener("load",()=>{this.initializeFormController(e.document)}),e.focus()}getTemplateData(){return{language:this.language,logoImg:this.logo?`<img src="${this.logo}" alt="Shop Logo"/>`:"",shopName:this.shopName,amount:this.formatAmount(),texts:{message:this.localization.tag("message"),no_app:this.localization.tag("no_app"),download:this.localization.tag("download"),card_label:this.localization.tag("card_label"),card_placeholder:this.localization.tag("card_placeholder"),card_error:this.localization.tag("error_message"),otp_label:this.localization.tag("otp_label"),submit_button:this.localization.tag("submit_button"),secured_payment:this.localization.tag("secured_payment")}}}_urlResolver(){var e="https://cdn.jsdelivr.net/gh/YTECH-DEV/ypay_js@master";const t=document.currentScript;if(t){const n=new URL(t.src),s=n.pathname.split("/").slice(0,-1).join("/");e=`${n.origin}${s}`}return e}renderTemplate(e){console.log(this._urlResolver());const t=this.getTemplateData();return e.replace(/\{\{language\}\}/g,t.language).replace(/\{\{logoImg\}\}/g,t.logoImg).replace(/\{\{closeBtn\}\}/g,this.modal?'<button class="close_modal" type="button">×</button>':"").replace(/\{\{shopName\}\}/g,t.shopName).replace(/\{\{amount\}\}/g,t.amount).replace(/\{\{texts\.message\}\}/g,t.texts.message).replace(/\{\{texts\.no_app\}\}/g,t.texts.no_app).replace(/\{\{texts\.download\}\}/g,t.texts.download).replace(/\{\{texts\.card_label\}\}/g,t.texts.card_label).replace(/\{\{texts\.card_placeholder\}\}/g,t.texts.card_placeholder).replace(/\{\{texts\.card_error\}\}/g,t.texts.card_error).replace(/\{\{texts\.otp_label\}\}/g,t.texts.otp_label).replace(/\{\{texts\.submit_button\}\}/g,t.texts.submit_button).replace(/\{\{texts\.secured_payment\}\}/g,t.texts.secured_payment).replace("./ypay_ui/",this._urlResolver())}initializeFormController(e){this.showLogs("Initializing form controller"),d(e);const t=e.getElementById("payment_form");t&&t.addEventListener("submit",e=>{e.preventDefault(),this.triggerPayment()})}async triggerPayment(){this.showLogs("Payment triggered",{amount:this.amount,currency:this.currency});const e=this.newWindowRef?this.newWindowRef.document:document,t=e.querySelector(".submit_button");try{const n=e.getElementById("card_code").value.trim(),s=e.getElementsByClassName("otp_input_item"),o=parseInt([...s].map(e=>e.value).join(""));this.showLogs("Processing payment with card:",n.substring(0,4)+"****"),t&&(t.innerHTML=this.localization.tag("submit_button_processing"));const a=await this.ypay.createTransaction(n,o,this.amount,this.localization.current);this.showLogs("Payment successful:",a),this.customAlert("success",a),this.closePaymentUI(),this.handlers.onSuccess&&this.handlers.onSuccess(a)}catch(n){this.showLogs("Payment error:",n),this.customAlert("failure",n),t&&(t.innerHTML=this.localization.tag("submit_button"),t.style.disabled=!1),this.handlers.onFailure&&this.handlers.onFailure(n)}}renderForm(){this.showLogs("Rendering payment form",{modal:this.modal,amount:this.amount,currency:this.currency}),this.modal?this.showModal():this.openNewTab()}showLogs(...e){this.verbose&&console.log("[PaymentUI]",...e)}};t(p,"instance");let m=p;return document.querySelectorAll(".payment_btn, .custom_payment_btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.amount||0,n=e.dataset.modal||!1;let s=m.instance;s.amount=parseFloat(t),s.modal=n,s.renderForm()})}),m});
//# sourceMappingURL=ypay-ui.umd.js.map

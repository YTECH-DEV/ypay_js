{"version":3,"file":"ypay-ui.umd.js","sources":["../src/sdk/patterns.js","../src/sdk/transaction.js","../src/sdk/enums.js","../src/sdk/ypay.js","../src/ypay_ui/js/localization.js","../src/ypay_ui/js/alert_controller.js","../src/ypay_ui/js/init_form_controller.js","../src/ypay_ui/templates/payment_form.html?raw","../src/ypay_ui/js/paymentUI.js","../src/ypay_ui/templates/custom_alert.html?raw","../src/ypay_ui/js/paymentTriggerButtons.js"],"sourcesContent":["const cardPattern = /^[A-Za-z0-9]{4}-[A-Za-z0-9]{4}$/;\nconst paymentCodePattern = /^[0-9]{6}$/;\nconst tokenPattern = /^[0-9]{1,}\\|[A-Za-z0-9]{48}$/;\n\nexport {cardPattern, paymentCodePattern, tokenPattern};","import {cardPattern, paymentCodePattern, tokenPattern} from \"./patterns.js\";\n\nclass Transaction\n{\n    constructor(token = \"\", sender = \"\", otp = \"\", amount = 0, language = \"en\", handlers = {})\n    {\n        this.sender = this.sanitizeData(sender);\n        this.token = this.sanitizeData(token);\n        this.otp = otp;\n        this.amount = parseFloat(amount.toString());\n        this.language = language;\n\n        this.paymentHandlers =\n        {\n            onSuccess: handlers.onSuccess || (() => {}),\n            onFailure: handlers.onFailure || (() => {})\n        };\n\n        // Validate during construction\n        const validationError = this._validate();\n        if (validationError)\n        {\n            this.validationError = validationError;\n        }\n    }\n\n    _validate()\n    {\n        const errors = [];\n\n        if (!this.sender)\n        {\n            errors.push(\"Sender card is required.\");\n        }\n        else if (!cardPattern.test(this.sender))\n        {\n            errors.push(\"Sender card format is invalid.\");\n        }\n\n        if (!this.token)\n        {\n            errors.push(\"token is required.\");\n        }\n        else if (!tokenPattern.test(this.token))\n        {\n            errors.push(\"token card format is invalid.\");\n        }\n\n        if (!this.otp)\n        {\n            errors.push(\"Payment code is required.\");\n        }\n        else if (!paymentCodePattern.test(this.otp))\n        {\n            errors.push(\"Payment code format is invalid.\");\n        }\n\n        if (isNaN(this.amount) || this.amount <= 0)\n        {\n            errors.push(\"Amount must be a positive number.\");\n        }\n\n        if (![\"en\", \"fr\"].includes(this.language.toString().toLowerCase()))\n        {\n            errors.push(\"Language is invalid.\");\n        }\n\n        return errors.length > 0 ? new Error(errors.join(\"\\n\")) : null;\n    }\n\n    async exec()\n    {\n        // Check for validation errors first\n        if (this.validationError)\n        {\n            this.paymentHandlers.onFailure(this.validationError);\n            throw this.validationError;\n        }\n\n        try\n        {\n            const paymentResponse = await fetch(\n                \"https://ypay.ytech-bf.com/api/v1/project/make-payment\",\n                {\n                    method: \"POST\",\n                    mode: \"cors\",\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"Authorization\": `Bearer ${this.token}`,\n                        \"accept-language\" : this.language,\n                    },\n                    body: JSON.stringify({\n                        card_code: this.sender,\n                        amount: this.amount,\n                        payment_code: this.otp\n                    })\n                }\n            );\n\n            // Check for successful status codes (200-299)\n            if (paymentResponse.ok)\n            {\n                const data = await paymentResponse.json();\n                this.paymentHandlers.onSuccess(data);\n                return data;\n            }\n\n            // Handle HTTP errors\n            const errorData = await paymentResponse.json().catch(() => ({}));\n            const errorMessage = errorData.message || paymentResponse.statusText || \"Payment failed\";\n            throw new Error(`${paymentResponse.status}\\n${errorMessage}`);\n        }\n        catch (error)\n        {\n            this.paymentHandlers.onFailure(error);\n            throw error;\n        }\n    }\n\n\n    // Validation checker\n    isValid()\n    {\n        return !this.validationError;\n    }\n\n    // Get validation errors without throwing\n    getValidationErrors()\n    {\n        return this.validationError ? this.validationError.message : null;\n    }\n\n    // Sanitizes data passed to the constructor\n    sanitizeData(data = \"\")\n    {\n        if (data === \"\" || data === null || data === undefined)\n        {\n            return \"\";\n        }\n\n        data = String(data);\n\n        // Remove null bytes\n        data = data.replace(/\\\\0/g, '');\n\n        // Trim whitespace\n        data = data.trim();\n\n        // Strip HTML tags\n        data = data.replace(/<[^>]*>/g, '');\n\n        return data;\n    }\n}\n\nexport default Transaction;","class Currency\n{\n    static USD = \"USD\"\n    static NGN = \"NGN\"\n    static XOF = \"F CFA\"\n\n    static isValid(currency)\n    {\n        return Object.values(this).includes(currency.toUpperCase());\n    }\n}\n\nexport {Currency};","import Transaction from \"./transaction.js\";\nimport {Currency} from \"./enums.js\";\n\n// ----- ONE TIME CONFIGURATIONS FOR YPAY PAYMENTS\nclass YPAY\n{\n    // one-time initialization\n    constructor(token, currency, shopName)\n    {\n        this.token = token;\n        this.currency = currency || Currency.XOF;\n        this.shopName = shopName || \"Undefined\";\n\n\n        // Validate during construction\n        const validationError = this._validate();\n        if (validationError)\n        {\n            this.validationError = validationError;\n        }\n\n        // singleton instance-like\n        if(YPAY.instance)\n        {\n            return YPAY.instance;\n        }\n\n        YPAY.instance = this;\n    }\n\n    // create a transaction and execute it\n    createTransaction(card_code, otp, amount, language, handlers = {})\n    {\n        return new Transaction(\n            this.token,\n            card_code,\n            otp,\n            amount,\n            language,\n            handlers\n        ).exec();\n    }\n\n    static resetInstance()\n    {\n        YPAY.instance = null;\n    }\n\n    _validate()\n    {\n        const errors = []\n\n        // checks currency\n        if(!Currency.isValid(this.currency))\n        {\n            errors.push(this.currency + \" is not supported yet\");\n        }\n\n        return errors.length > 0 ? new Error(errors.join(\"\\n\")) : null;\n    }\n}\n\nexport default YPAY;","class Localization\n{\n    constructor()\n    {\n        this.current = \"en\";\n\n        this.languages = {\n            en: \"en\",\n            fr: \"fr\",\n        };\n\n        this.translations = {\n            en: {\n                card_label: \"Card number\",\n                card_placeholder: \"Enter your card number\",\n                otp_label: \"Enter OTP\",\n                message: 'In order to continue the payment process, you must first log in from the <a href=\"#\">YPAY</a> application, then generate a payment OTP with a value of ',\n                no_app: \"I do not have the app yet.\",\n                download: \"Download the App\",\n                submit_button_processing: \"Processing...\",\n                submit_button: \"Submit\",\n                error_message: \"Enter XXXX-XXXX with letters/digits only.\",\n                secured_payment: \"Encrypted and Secured Payment\",\n                successful_transaction: \"Your transaction was successfully processed!\",\n                failure_transaction: \"Your transaction has not been processed!\",\n            },\n            fr: {\n                card_label: \"Numéro de carte\",\n                card_placeholder: \"Entrez votre numéro de carte\",\n                otp_label: \"Entrez le code OTP\",\n                message: 'Pour continuer le processus de paiement, vous devez d\\'abord vous connecter depuis l\\'application <a href=\"#\">YPAY</a>, puis generer un OTP de paiement d\\'une valeur de ',\n                download: \"Télécharger l'application\",\n                submit_button_processing: \"Traitement en cours...\",\n                submit_button: \"Valider\",\n                no_app: \"Je n'ai pas l'application\",\n                error_message: \"Format XXXX-XXXX avec lettres et chiffres uniquement.\",\n                secured_payment: \"Paiement crypté et sécurisé\",\n                successful_transaction: \"Votre transaction a été traitée avec succès!\",\n                failure_transaction: \"Votre transaction n'a pas pu être traitée!\"\n            }\n        };\n    }\n\n    isValid(lang)\n    {\n        return Object.values(this.languages).includes(lang.toLowerCase());\n    }\n\n    setLang(lang)\n    {\n        switch (lang)\n        {\n            case this.languages.en:\n                this.current = \"en\";\n                break;\n            case this.languages.fr:\n                this.current = \"fr\";\n                break;\n            default:\n                this.current = \"en\";\n        }\n    }\n\n    tag(key)\n    {\n        return this.translations[this.current][key] || key;\n    }\n\n}\n\n\nexport default Localization;","const alertController = (target= document, type = \"success\", message = \"\") =>\n{\n    const alertBox = target.querySelector(\".alert\")\n    const title = alertBox.getElementsByTagName(\"h2\")[0]\n    const messageTag = alertBox.getElementsByTagName(\"p\")[0]\n\n    title.innerHTML = type[0].toUpperCase() + type.substring(1, type.length)\n    messageTag.innerHTML = message\n\n    if (type === \"failure\")\n    {\n        alertBox.classList.add(\"alert-failure\")\n        alertBox.classList.remove(\"alert-success\")\n    }\n}\n\nexport default alertController;","import {cardPattern} from \"../../sdk/patterns.js\";\n\nconst primary_color = \"#6047FF\";\nconst error_color = \"#FF0000\";\nconst disabled = \"#E5E7EB\";\n\n\n// Main initialization function\nconst initFormController = (targetDocument = document) =>\n{\n    // ============ DOM ELEMENT SELECTION ==========\n    const form = targetDocument.querySelector(\"form\");\n    const app_button = targetDocument.querySelector(\"#app_button\");\n    const card_code = targetDocument.querySelector(\"#card_code\");\n    const card_number_icon = targetDocument.querySelector(\".card_icon\");\n    const error_message_card_number = targetDocument.querySelector('.error_message');\n    const otp_inputs = [...targetDocument.querySelectorAll(\".otp_input_item\")];\n    const submit = targetDocument.querySelector(\".submit_button\")\n\n    // hides the error message by default\n    error_message_card_number.style.display = 'none';\n\n    // Check if elements exist\n    if (!form || !card_code || !submit || otp_inputs.length === 0)\n    {\n        console.error(\"Form elements not found\");\n        return;\n    }\n\n    // ======== METHODS =======\n    // Submit button state\n    const submitState = (isFormValid) =>\n    {\n        if (isFormValid)\n        {\n            submit.disabled = false;\n            submit.style.backgroundColor = primary_color;\n            submit.style.cursor = \"pointer\";\n        }\n        else\n        {\n            submit.disabled = true;\n            submit.style.backgroundColor = disabled;\n            submit.style.cursor = \"not-allowed\";\n        }\n    };\n\n    // Card number validations\n    const cardNumberValidation = () =>\n    {\n\n        // Regex validation\n        if (cardPattern.test(card_code.value.toString()))\n        {\n            card_code.style.outlineColor = primary_color;\n            if (card_number_icon)\n            {\n                card_number_icon.style.color = primary_color;\n            }\n            card_code.style.border = `1px solid ${primary_color}`;\n\n            if (error_message_card_number)\n            {\n                error_message_card_number.style.display = 'none';\n            }\n\n            validateOTP();\n\n            if (card_number_icon)\n            {\n                card_number_icon.style.top = \"50%\";\n            }\n        }\n        else\n        {\n            card_code.style.outlineColor = error_color;\n            if (card_number_icon)\n            {\n                card_number_icon.style.color = error_color;\n            }\n            card_code.style.border = `1px solid ${error_color}`;\n\n            if (!targetDocument.querySelector('.error_message'))\n            {\n                const error_message_card_number = targetDocument.createElement(\"span\");\n                error_message_card_number.className = \"error_message\";\n            }\n\n            error_message_card_number.style.color = error_color;\n            error_message_card_number.style.fontSize = \"11px\";\n            error_message_card_number.style.fontStyle = \"italic\";\n            error_message_card_number.style.marginTop = \"4px\";\n            error_message_card_number.style.display = \"block\";\n\n            if (card_number_icon)\n            {\n                card_number_icon.style.top = \"35%\";\n            }\n\n            card_code.parentNode.appendChild(error_message_card_number);\n\n            submitState(false);\n        }\n    };\n\n    // OTP validation\n    const validateOTP = () =>\n    {\n        const allFilled = otp_inputs.every(input => input.value.length === 1);\n\n        otp_inputs.forEach(input =>\n        {\n            if (allFilled)\n            {\n                input.style.borderColor = primary_color;\n                input.style.outlineColor = primary_color;\n            }\n            else if (input.value === '')\n            {\n                input.style.borderColor = '';\n            }\n        });\n\n        const isCardValid = cardPattern.test(card_code.value);\n        submitState(isCardValid && allFilled);\n    };\n\n    // ======== OTP INPUT HANDLERS =======\n    const handleKeyDown = (e) =>\n    {\n        if (!/^[0-9]$/.test(e.key) && e.key !== 'Backspace' && e.key !== 'Delete' && e.key !== 'Tab' && !e.metaKey && !e.ctrlKey)\n        {\n            e.preventDefault();\n        }\n\n        if (e.key === 'Delete' || e.key === 'Backspace')\n        {\n            const index = otp_inputs.indexOf(e.target);\n            if (index >= 0)\n            {\n                otp_inputs[index].value = '';\n                if (index > 0)\n                {\n                    otp_inputs[index - 1].focus();\n                }\n            }\n            validateOTP();\n            e.preventDefault();\n        }\n    };\n\n    const handleInput = (e) =>\n    {\n        const { target } = e;\n        const index = otp_inputs.indexOf(target);\n        if (target.value)\n        {\n            if (index < otp_inputs.length - 1)\n            {\n                otp_inputs[index + 1].focus();\n            }\n            else\n            {\n                submit.focus();\n            }\n        }\n        validateOTP();\n    };\n\n    const handleFocus = (e) =>\n    {\n        e.target.select();\n    };\n\n    const handlePaste = (e) =>\n    {\n        e.preventDefault();\n        const text = e.clipboardData.getData('text');\n\n        if (!new RegExp(`^[0-9]{${otp_inputs.length}}$`).test(text))\n        {\n            return;\n        }\n        const digits = text.split('');\n        otp_inputs.forEach((input, index) => input.value = digits[index]);\n        validateOTP();\n        submit.focus();\n    };\n\n    // ======== LISTENERS =======\n    // Card number listener\n    card_code.addEventListener(\"input\", function(e)\n    {\n        let value = card_code.value.toString().replace(/-/g, '');\n\n        // Add hyphen after the first 4 characters\n        if (value.length > 4)\n        {\n            value = value.slice(0, 4) + '-' + value.slice(4);\n        }\n\n        // Limit to 9 characters (XXXX-XXXX)\n        card_code.value = value.slice(0, 9);\n        cardNumberValidation();\n    });\n\n    // OTP input listeners\n    otp_inputs.forEach((input) =>\n    {\n        input.addEventListener('paste', handlePaste);\n        input.addEventListener('input', handleInput);\n        input.addEventListener('keydown', handleKeyDown);\n        input.addEventListener('focus', handleFocus);\n    });\n\n    app_button.addEventListener(\"click\", (e)=>\n    {\n        e.preventDefault();\n        window.open(\"https://ypay.ytech-bf.com/\")\n    });\n\n\n    // Initialize\n    submit.disabled = true;\n    submitState(false);\n\n};\n\n// Export for module usage\nexport default initFormController;","export default \"<!DOCTYPE html>\\n<html lang=\\\"{{language}}\\\">\\n<head>\\n    <meta charset=\\\"UTF-8\\\">\\n    <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\">\\n    <title>Payment Gateway</title>\\n    <link rel=\\\"stylesheet\\\" href=\\\"./ypay_ui/styles/style.css\\\">\\n</head>\\n<body>\\n<div class=\\\"modal_box\\\">\\n    <!--       HEADER     -->\\n    <div class=\\\"modal_header\\\">\\n        <div class=\\\"first_stack\\\">\\n            <div class=\\\"shop_icon\\\">{{logoImg}}</div>\\n            <div class=\\\"ytech_icon\\\">\\n                {{closeBtn}}\\n                <img src=\\\"./ypay_ui/assets/images/logo_inverted.svg\\\" alt=\\\"ypay logo\\\">\\n            </div>\\n        </div>\\n        <span class=\\\"second_stack\\\">{{shopName}}</span>\\n        <span class=\\\"third_stack\\\">{{amount}}</span>\\n    </div>\\n\\n    <!--       YTECH MOBILE APP     -->\\n    <div class=\\\"modal_info\\\">\\n        <div class=\\\"message\\\">{{texts.message}} <a>{{amount}}</a></div>\\n        <div class=\\\"separator\\\"> <hr> {{texts.no_app}} <hr></div>\\n        <div class=\\\"download_button\\\">\\n            <button type=\\\"button\\\" id=\\\"app_button\\\">\\n                {{texts.download}}\\n                <svg class=\\\"download_icon\\\" width=\\\"20px\\\" height=\\\"20px\\\" stroke-width=\\\"1.5\\\" viewBox=\\\"0 0 20 20\\\" fill=\\\"none\\\">\\n                    <path d=\\\"M6 20L18 20\\\" stroke=\\\"#000000\\\" stroke-width=\\\"1.5\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path>\\n                    <path d=\\\"M12 4V16M12 16L15.5 12.5M12 16L8.5 12.5\\\" stroke=\\\"#000000\\\" stroke-width=\\\"1.5\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path>\\n                </svg>\\n            </button>\\n        </div>\\n    </div>\\n\\n    <!--     FORM     -->\\n    <div class=\\\"modal_form\\\">\\n        <form action=\\\"#\\\" id=\\\"payment_form\\\">\\n            <div class=\\\"form_item\\\">\\n                <label class=\\\"card_label\\\" for=\\\"card_code\\\">{{texts.card_label}}</label><br>\\n                <div class=\\\"card_input_container\\\">\\n                    <svg class=\\\"card_icon\\\" width=\\\"21px\\\" height=\\\"22px\\\" viewBox=\\\"0 0 22 22\\\" stroke-width=\\\"1.5\\\" fill=\\\"none\\\">\\n                        <path d=\\\"M22 9V17C22 18.1046 21.1046 19 20 19H4C2.89543 19 2 18.1046 2 17V7C2 5.89543 2.89543 5 4 5H20C21.1046 5 22 5.89543 22 7V9ZM22 9H6\\\" stroke=\\\"#000000\\\" stroke-width=\\\"1.5\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path>\\n                        <path d=\\\"M16.5 13.3819C16.7654 13.1444 17.1158 13 17.5 13C18.3284 13 19 13.6716 19 14.5C19 15.3284 18.3284 16 17.5 16C17.1158 16 16.7654 15.8556 16.5 15.6181\\\" stroke=\\\"#000000\\\" stroke-width=\\\"1.5\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path>\\n                        <path d=\\\"M16.5 13.3819C16.2346 13.1444 15.8842 13 15.5 13C14.6716 13 14 13.6716 14 14.5C14 15.3284 14.6716 16 15.5 16C15.8842 16 16.2346 15.8556 16.5 15.6181\\\" stroke=\\\"#000000\\\" stroke-width=\\\"1.5\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path>\\n                    </svg>\\n                    <input id=\\\"card_code\\\" class=\\\"card_code_input\\\" type=\\\"text\\\" autocomplete=\\\"off\\\" placeholder=\\\"{{texts.card_placeholder}}\\\" required>\\n                    <span class=\\\"error_message\\\">{{texts.card_error}}</span>\\n                </div>\\n            </div>\\n\\n            <div class=\\\"form_item\\\">\\n                <label for=\\\"otp_inputs\\\" class=\\\"otp_label\\\">{{texts.otp_label}}</label><br>\\n                <div id=\\\"otp_inputs\\\" class=\\\"otp_inputs\\\">\\n                    <label><input class=\\\"otp_input_item\\\" type=\\\"text\\\" maxlength=\\\"1\\\" inputmode=\\\"numeric\\\" autocomplete=\\\"off\\\" required></label>\\n                    <label><input class=\\\"otp_input_item\\\" type=\\\"text\\\" maxlength=\\\"1\\\" inputmode=\\\"numeric\\\"  autocomplete=\\\"off\\\" required></label>\\n                    <label><input class=\\\"otp_input_item\\\" type=\\\"text\\\" maxlength=\\\"1\\\" inputmode=\\\"numeric\\\"  autocomplete=\\\"off\\\" required></label>\\n                    <label><input class=\\\"otp_input_item\\\" type=\\\"text\\\" maxlength=\\\"1\\\" inputmode=\\\"numeric\\\"  autocomplete=\\\"off\\\" required></label>\\n                    <label><input class=\\\"otp_input_item\\\" type=\\\"text\\\" maxlength=\\\"1\\\" inputmode=\\\"numeric\\\"  autocomplete=\\\"off\\\" required></label>\\n                    <label><input class=\\\"otp_input_item\\\" type=\\\"text\\\" maxlength=\\\"1\\\" inputmode=\\\"numeric\\\"  autocomplete=\\\"off\\\" required></label>\\n                </div>\\n            </div>\\n\\n            <div class=\\\"form_item\\\">\\n                <button class=\\\"submit_button\\\" type=\\\"submit\\\">{{texts.submit_button}}</button>\\n            </div>\\n        </form>\\n\\n        <!--       SECURED MESSAGE     -->\\n        <div class=\\\"secured_payment\\\">\\n            <svg class=\\\"secured_payment_icon\\\" width=\\\"18px\\\" height=\\\"18px\\\" viewBox=\\\"0 0 24 24\\\" stroke-width=\\\"1.5\\\" fill=\\\"none\\\" color=\\\"#000000\\\">\\n                <path d=\\\"M22 9V7C22 5.89543 21.1046 5 20 5H4C2.89543 5 2 5.89543 2 7V17C2 18.1046 2.89543 19 4 19H14M22 9H6M22 9V13\\\" stroke=\\\"#000000\\\" stroke-width=\\\"1.5\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path>\\n                <path d=\\\"M21.1667 18.5H21.4C21.7314 18.5 22 18.7686 22 19.1V21.4C22 21.7314 21.7314 22 21.4 22H17.6C17.2686 22 17 21.7314 17 21.4V19.1C17 18.7686 17.2686 18.5 17.6 18.5H17.8333M21.1667 18.5V16.75C21.1667 16.1667 20.8333 15 19.5 15C18.1667 15 17.8333 16.1667 17.8333 16.75V18.5M21.1667 18.5H17.8333\\\" stroke=\\\"#000000\\\" stroke-width=\\\"1.5\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path>\\n            </svg>\\n            <span>{{texts.secured_payment}}</span>\\n        </div>\\n    </div>\\n</div>\\n</body>\\n</html>\"","import YPAY from \"../../sdk/ypay.js\";\nimport Localization from \"./localization.js\";\nimport alertController from \"./alert_controller.js\";\nimport initFormController from \"./init_form_controller.js\";\n\n// Import HTML templates as raw strings\nimport paymentFormTemplate from '../templates/payment_form.html?raw';\nimport customAlertTemplate from '../templates/custom_alert.html?raw';\n\nclass PaymentUI\n{\n    static instance;\n\n    constructor(token, currency, language, handlers = {}, showDialogs = true, verbose = true, shopName, logo)\n    {\n        if (PaymentUI.instance)\n        {\n            return PaymentUI.instance;\n        }\n\n        this.logo = logo || '';\n        this.language = language || 'en';\n        this.shopName = shopName || 'Unknown';\n        this.currency = currency || 'XOF';\n        this.token = token;\n        this.modal = false;\n        this.verbose = verbose;\n\n        this.showDialogs = this._normalizeShowDialogs(showDialogs);\n        this.handlers = handlers || {\n            onSuccess: (data) => {},\n            onFailure: (data) => {},\n        };\n\n        this.overlayElement = null;\n        this.newWindowRef = null;\n        this.alert = null;\n        this.amount = 0;\n\n        this.localization = new Localization();\n        this.localization.setLang(this.language);\n\n        this._validate();\n        this.ypay = new YPAY(token, currency, shopName);\n\n        PaymentUI.instance = this;\n        return this;\n    }\n\n    _normalizeShowDialogs(showDialogs)\n    {\n        if (typeof showDialogs === 'boolean') {\n            return {\n                onSuccess: showDialogs,\n                onFailure: showDialogs\n            };\n        } else if (typeof showDialogs === 'object' && showDialogs !== null) {\n            return {\n                onSuccess: showDialogs.onSuccess !== undefined ? showDialogs.onSuccess : true,\n                onFailure: showDialogs.onFailure !== undefined ? showDialogs.onFailure : true\n            };\n        }\n        return { onSuccess: true, onFailure: true };\n    }\n\n    toString()\n    {\n        return `PaymentUI {\n          shopName: \"${this.shopName}\",\n          currency: \"${this.currency}\",\n          language: \"${this.language}\",\n          token: \"${this.token ? this.token.substring(0, 8) + '...' : 'none'}\",\n          amount: ${this.amount},\n          modal: ${this.modal},\n          showDialogs: { onSuccess: ${this.showDialogs.onSuccess}, onFailure: ${this.showDialogs.onFailure} },\n          verbose: ${this.verbose},\n          hasLogo: ${!!this.logo},\n          handlers: ${Object.keys(this.handlers).join(', ')}\n        }`;\n    }\n\n    _validate()\n    {\n        let errors = [];\n\n        if (this.language && !this.localization.isValid(this.language))\n        {\n            errors.push('Language is not available');\n        }\n\n        if (this.token === \"\")\n        {\n            errors.push('Token is required');\n        }\n\n        if (errors.length > 0)\n        {\n            this.showLogs('Validation errors:', errors.join('\\n'));\n            throw new Error(errors.join('\\n'));\n        }\n    }\n\n    _getTargetDocument()\n    {\n        if (this.overlayElement)\n        {\n            return document;\n        }\n        if (this.newWindowRef && !this.newWindowRef.closed)\n        {\n            try\n            {\n                if (this.newWindowRef.document)\n                {\n                    return this.newWindowRef.document;\n                }\n            }\n            catch (error)\n            {\n                this.showLogs('Cannot access popup window document:', error.message);\n            }\n        }\n        return document;\n    }\n\n    closePaymentUI()\n    {\n        this.showLogs('Closing payment UI');\n\n        if (this.overlayElement)\n        {\n            this.overlayElement.remove();\n            this.overlayElement = null;\n        }\n\n        if (this.newWindowRef && !this.newWindowRef.closed)\n        {\n            this.newWindowRef.close();\n            this.newWindowRef = null;\n        }\n    }\n\n    customAlertController(targetDocument, type, message)\n    {\n        alertController(targetDocument, type, message);\n    }\n\n    customAlert(type, message)\n    {\n        const shouldShow = type === 'success' ? this.showDialogs.onSuccess : this.showDialogs.onFailure;\n\n        if (!shouldShow)\n        {\n            this.showLogs(`Alert (${type}):`, message);\n            return;\n        }\n\n        const overlay = document.createElement('div');\n        overlay.className = 'alert-overlay';\n        overlay.innerHTML = this.renderTemplate(customAlertTemplate);\n        this.alert = overlay;\n\n        document.body.appendChild(this.alert);\n        this.customAlertController(document, type, message);\n\n        const alertBox = this.alert.querySelector(\".alert\");\n        const closingButton = alertBox.querySelector(\".close\");\n        const okButton = alertBox.getElementsByTagName(\"button\")[0];\n\n        const close = () =>\n        {\n            if (this.alert && this.alert.parentNode)\n            {\n                this.alert.parentNode.removeChild(this.alert);\n                this.alert = null;\n            }\n\n            let submit_btn = this._getTargetDocument().getElementsByClassName(\"submit_button\")[0];\n            if (submit_btn)\n            {\n                submit_btn.innerHTML = this.localization.tag(\"submit_button\");\n                submit_btn.disabled = false;\n            }\n        };\n\n        closingButton.addEventListener(\"click\", close);\n        okButton.addEventListener(\"click\", close);\n    }\n\n    formatAmount()\n    {\n        return this.language === 'fr'\n            ? `${this.amount} ${this.currency}`\n            : `${this.currency} ${this.amount}`;\n    }\n\n    showModal()\n    {\n        this.showLogs('Opening payment modal');\n\n        const overlay = document.createElement('div');\n        overlay.className = 'modal_overlay';\n        overlay.innerHTML = this.renderTemplate(paymentFormTemplate);\n\n        this.overlayElement = overlay;\n        document.body.appendChild(overlay);\n\n        setTimeout(() =>\n        {\n            const closeBtn = document.querySelector('.close_modal');\n            if (closeBtn)\n            {\n                closeBtn.addEventListener('click', () =>\n                {\n                    this.closePaymentUI();\n                });\n            }\n\n            const overlay = document.querySelector('.modal_overlay');\n            if (overlay)\n            {\n                document.addEventListener('keydown', (e) =>\n                {\n                    if (e.key === 'Escape')\n                    {\n                        this.closePaymentUI();\n                    }\n                });\n            }\n\n            this.initializeFormController(document);\n        }, 0);\n    }\n\n    openNewTab()\n    {\n        this.showLogs('Opening payment in new tab');\n\n        const newTab = window.open(\"\", '_blank');\n\n        if (!newTab)\n        {\n            const errorMsg = 'Popup blocked - please allow popups for this site';\n            this.showLogs(errorMsg);\n            throw new Error(errorMsg);\n        }\n\n        this.newWindowRef = newTab;\n        newTab.document.write(this.renderTemplate(paymentFormTemplate));\n        newTab.document.close();\n\n        newTab.addEventListener('load', () =>\n        {\n            this.initializeFormController(newTab.document);\n        });\n\n        newTab.focus();\n    }\n\n    getTemplateData()\n    {\n        return {\n            language: this.language,\n            logoImg: this.logo ? `<img src=\"${this.logo}\" alt=\"Shop Logo\"/>` : '',\n            shopName: this.shopName,\n            amount: this.formatAmount(),\n            texts: {\n                message: this.localization.tag(\"message\"),\n                no_app: this.localization.tag(\"no_app\"),\n                download: this.localization.tag(\"download\"),\n                card_label: this.localization.tag(\"card_label\"),\n                card_placeholder: this.localization.tag(\"card_placeholder\"),\n                card_error: this.localization.tag(\"error_message\"),\n                otp_label: this.localization.tag(\"otp_label\"),\n                submit_button: this.localization.tag(\"submit_button\"),\n                secured_payment: this.localization.tag(\"secured_payment\")\n            }\n        };\n    }\n\n    _urlResolver()\n    {\n        var baseUrl = 'https://cdn.jsdelivr.net/gh/YTECH-DEV/ypay_js@master';\n        // Auto-detect where the script was loaded from\n        const script = document.currentScript;\n        if (script)\n        {\n            // Extract directory from script URL\n            const scriptUrl = new URL(script.src);\n            const basePath = scriptUrl.pathname.split('/').slice(0, -1).join('/');\n            baseUrl = `${scriptUrl.origin}${basePath}`;\n        }\n        return baseUrl;\n    }\n\n    renderTemplate(template)\n    {\n        console.log(this._urlResolver())\n        const data = this.getTemplateData();\n\n        return template\n            .replace(/\\{\\{language\\}\\}/g, data.language)\n            .replace(/\\{\\{logoImg\\}\\}/g, data.logoImg)\n            .replace(/\\{\\{closeBtn\\}\\}/g, this.modal ? '<button class=\"close_modal\" type=\"button\">×</button>' : '')\n            .replace(/\\{\\{shopName\\}\\}/g, data.shopName)\n            .replace(/\\{\\{amount\\}\\}/g, data.amount)\n            .replace(/\\{\\{texts\\.message\\}\\}/g, data.texts.message)\n            .replace(/\\{\\{texts\\.no_app\\}\\}/g, data.texts.no_app)\n            .replace(/\\{\\{texts\\.download\\}\\}/g, data.texts.download)\n            .replace(/\\{\\{texts\\.card_label\\}\\}/g, data.texts.card_label)\n            .replace(/\\{\\{texts\\.card_placeholder\\}\\}/g, data.texts.card_placeholder)\n            .replace(/\\{\\{texts\\.card_error\\}\\}/g, data.texts.card_error)\n            .replace(/\\{\\{texts\\.otp_label\\}\\}/g, data.texts.otp_label)\n            .replace(/\\{\\{texts\\.submit_button\\}\\}/g, data.texts.submit_button)\n            .replace(/\\{\\{texts\\.secured_payment\\}\\}/g, data.texts.secured_payment)\n            .replace(\"./ypay_ui/\", this._urlResolver());\n    }\n\n    initializeFormController(targetDocument)\n    {\n        this.showLogs('Initializing form controller');\n        initFormController(targetDocument);\n\n        const form = targetDocument.getElementById('payment_form');\n        if (form)\n        {\n            form.addEventListener('submit', (e) =>\n            {\n                e.preventDefault();\n                this.triggerPayment();\n            });\n        }\n    }\n\n    async triggerPayment()\n    {\n        this.showLogs('Payment triggered',\n            {\n            amount: this.amount,\n            currency: this.currency\n        });\n\n        const doc = this.newWindowRef ? this.newWindowRef.document : document;\n        const submit_button = doc.querySelector(\".submit_button\");\n\n        try\n        {\n            const cardInput = doc.getElementById(\"card_code\");\n            const card_code = cardInput.value.trim();\n\n            const otpInputs = doc.getElementsByClassName(\"otp_input_item\");\n            const otp = parseInt([...otpInputs].map(elem => elem.value).join(\"\"));\n\n            this.showLogs('Processing payment with card:', card_code.substring(0, 4) + '****');\n\n            if (submit_button)\n            {\n                submit_button.innerHTML = this.localization.tag(\"submit_button_processing\");\n            }\n\n            const data = await this.ypay.createTransaction(card_code, otp, this.amount, this.localization.current);\n\n            this.showLogs('Payment successful:', data);\n            this.customAlert('success', data);\n            this.closePaymentUI();\n\n            if (this.handlers.onSuccess)\n            {\n                this.handlers.onSuccess(data);\n            }\n        }\n        catch (err)\n        {\n            this.showLogs('Payment error:', err);\n            this.customAlert('failure', err);\n\n            if (submit_button)\n            {\n                submit_button.innerHTML = this.localization.tag(\"submit_button\");\n                submit_button.style.disabled = false;\n            }\n\n            if (this.handlers.onFailure)\n            {\n                this.handlers.onFailure(err);\n            }\n        }\n    }\n\n    renderForm()\n    {\n        this.showLogs('Rendering payment form', {\n            modal: this.modal,\n            amount: this.amount,\n            currency: this.currency\n        });\n\n        if (this.modal)\n        {\n            this.showModal();\n        }\n        else\n        {\n            this.openNewTab();\n        }\n    }\n\n    showLogs(...args)\n    {\n        if (this.verbose)\n        {\n            console.log('[PaymentUI]', ...args);\n        }\n    }\n}\n\nexport default PaymentUI;","export default \"<!DOCTYPE html>\\n<html lang=\\\"en\\\">\\n<head>\\n    <meta charset=\\\"UTF-8\\\">\\n    <title>Alert</title>\\n    <link rel=\\\"stylesheet\\\" href=\\\"./ypay_ui/styles/style.css\\\">\\n</head>\\n<body>\\n    <div class=\\\"alert alert-success\\\">\\n        <a href=\\\"#\\\" class=\\\"close\\\"  aria-label=\\\"close\\\">×</a>\\n        <div>\\n            <h2>Alert</h2>\\n            <p>The payment has been processed successfully</p>\\n        </div>\\n        <button>OK</button>\\n    </div>\\n</body>\\n</html>\"","import PaymentUI from \"./paymentUI.js\";\n\nconst paymentTriggerButtons = () =>\n{\n    // get all matching buttons\n    const paymentUIButtons = document.querySelectorAll(\".payment_btn, .custom_payment_btn\");\n\n    paymentUIButtons.forEach(btn =>\n    {\n        btn.addEventListener(\"click\", () =>\n        {\n            const amount = btn.dataset.amount || 0; // gets the amount attached to the button\n            const modal = btn.dataset.modal || false; // get the type of form to display\n\n            // retrieves the payment ypay_ui singleton\n            let paymentUIInstance = PaymentUI.instance;\n            // affects the buttons parameters to the payment instance\n            paymentUIInstance.amount = parseFloat(amount);\n            paymentUIInstance.modal = modal;\n            paymentUIInstance.renderForm();\n        });\n    });\n};\n\nexport default paymentTriggerButtons;"],"names":["cardPattern","paymentCodePattern","tokenPattern","Transaction","constructor","token","sender","otp","amount","language","handlers","this","sanitizeData","parseFloat","toString","paymentHandlers","onSuccess","onFailure","validationError","_validate","errors","test","push","isNaN","includes","toLowerCase","length","Error","join","exec","paymentResponse","fetch","method","mode","headers","Authorization","body","JSON","stringify","card_code","payment_code","ok","data","json","errorMessage","catch","message","statusText","status","error","isValid","getValidationErrors","String","replace","trim","Currency","currency","Object","values","toUpperCase","__publicField","YPAY","shopName","XOF","instance","createTransaction","resetInstance","Localization","current","languages","en","fr","translations","card_label","card_placeholder","otp_label","no_app","download","submit_button_processing","submit_button","error_message","secured_payment","successful_transaction","failure_transaction","lang","setLang","tag","key","primary_color","error_color","initFormController","targetDocument","document","form","querySelector","app_button","card_number_icon","error_message_card_number","otp_inputs","querySelectorAll","submit","style","display","console","submitState","isFormValid","disabled","backgroundColor","cursor","validateOTP","allFilled","every","input","value","forEach","borderColor","outlineColor","isCardValid","handleKeyDown","e","metaKey","ctrlKey","preventDefault","index","indexOf","target","focus","handleInput","handleFocus","select","handlePaste","text","clipboardData","getData","RegExp","digits","split","addEventListener","slice","color","border","top","createElement","className","fontSize","fontStyle","marginTop","parentNode","appendChild","window","open","paymentFormTemplate","_PaymentUI","showDialogs","verbose","logo","modal","_normalizeShowDialogs","overlayElement","newWindowRef","alert","localization","ypay","substring","keys","showLogs","_getTargetDocument","closed","closePaymentUI","remove","close","customAlertController","type","alertBox","title","getElementsByTagName","messageTag","innerHTML","classList","add","alertController","customAlert","overlay","renderTemplate","closingButton","okButton","removeChild","submit_btn","getElementsByClassName","formatAmount","showModal","setTimeout","closeBtn","initializeFormController","openNewTab","newTab","errorMsg","write","getTemplateData","logoImg","texts","card_error","_urlResolver","baseUrl","script","currentScript","scriptUrl","URL","src","basePath","pathname","origin","template","log","getElementById","triggerPayment","doc","otpInputs","parseInt","map","elem","err","renderForm","args","PaymentUI","btn","dataset","paymentUIInstance"],"mappings":"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"}